{% comment %}

- Our reverse proxy must be configured to pass the original host header in X-Forwarded-Host.
- Django must be configured to use the X-Forwarded-Host header in preference to the Host header: USE_X_FORWARDED_HOST = True.
- MEDIA_URL must end in a slash if set to a non-empty value as per docs; assumed is that it also starts with one.
- Add 'django.template.context_processors.media' in the 'context_processors' option of TEMPLATES.

{% endcomment %}

(function () {

  window.Lizard = window.Lizard || {}; // don't override existing Lizard namespace.

  Lizard.startPlugins = function () {

    var appsButton = document.getElementById('lizard-apps-button');
    var title = appsButton.title;

    appsButton.innerHTML = '' +

      '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">' +
        '<path id="nine-blocks-lizard" d="m 28.928575,79.407709 0,13.6363 q 0,2.8409 -1.5625,4.8296 -1.5625,1.9886 -3.79465,1.9886 l -17.8571393,0 q -2.23214,0 -3.79464,-1.9886 -1.56250001,-1.9887 -1.56250001,-4.8296 l 0,-13.6363 q 0,-2.841 1.56250001,-4.8296 1.5625,-1.9886 3.79464,-1.9886 l 17.8571393,0 q 2.23215,0 3.79465,1.9886 1.5625,1.9886 1.5625,4.8296 z m 0,-36.3637 0,13.6364 q 0,2.8409 -1.5625,4.8295 -1.5625,1.9887 -3.79465,1.9887 l -17.8571393,0 q -2.23214,0 -3.79464,-1.9887 -1.56250001,-1.9886 -1.56250001,-4.8295 l 0,-13.6364 q 0,-2.8409 1.56250001,-4.8295 1.5625,-1.9887 3.79464,-1.9887 l 17.8571393,0 q 2.23215,0 3.79465,1.9887 1.5625,1.9886 1.5625,4.8295 z m 35.71428,36.3637 0,13.6363 q 0,2.8409 -1.5625,4.8296 -1.5625,1.9886 -3.79464,1.9886 l -17.85714,0 q -2.23215,0 -3.79465,-1.9886 -1.5625,-1.9887 -1.5625,-4.8296 l 0,-13.6363 q 0,-2.841 1.5625,-4.8296 1.5625,-1.9886 3.79465,-1.9886 l 17.85714,0 q 2.23214,0 3.79464,1.9886 1.5625,1.9886 1.5625,4.8296 z m -35.71428,-72.7273004 0,13.6363004 q 0,2.841 -1.5625,4.8296 -1.5625,1.9886 -3.79465,1.9886 l -17.8571393,0 q -2.23214,0 -3.79464,-1.9886 -1.56250001,-1.9886 -1.56250001,-4.8296 l 0,-13.6363004 q 0,-2.8409 1.56250001,-4.8296 1.5625,-1.98860003 3.79464,-1.98860003 l 17.8571393,0 q 2.23215,0 3.79465,1.98860003 1.5625,1.9887 1.5625,4.8296 z m 35.71428,36.3636004 0,13.6364 q 0,2.8409 -1.5625,4.8295 -1.5625,1.9887 -3.79464,1.9887 l -17.85714,0 q -2.23215,0 -3.79465,-1.9887 -1.5625,-1.9886 -1.5625,-4.8295 l 0,-13.6364 q 0,-2.8409 1.5625,-4.8295 1.5625,-1.9887 3.79465,-1.9887 l 17.85714,0 q 2.23214,0 3.79464,1.9887 1.5625,1.9886 1.5625,4.8295 z m 35.714295,36.3637 0,13.6363 q 0,2.8409 -1.562505,4.8296 -1.5625,1.9886 -3.79465,1.9886 l -17.85714,0 q -2.23214,0 -3.79464,-1.9886 -1.5625,-1.9887 -1.5625,-4.8296 l 0,-13.6363 q 0,-2.841 1.5625,-4.8296 1.5625,-1.9886 3.79464,-1.9886 l 17.85714,0 q 2.23215,0 3.79465,1.9886 1.562505,1.9886 1.562505,4.8296 z M 64.642855,6.6804086 l 0,13.6363004 q 0,2.841 -1.5625,4.8296 -1.5625,1.9886 -3.79464,1.9886 l -17.85714,0 q -2.23215,0 -3.79465,-1.9886 -1.5625,-1.9886 -1.5625,-4.8296 l 0,-13.6363004 q 0,-2.8409 1.5625,-4.8296 1.5625,-1.98860003 3.79465,-1.98860003 l 17.85714,0 q 2.23214,0 3.79464,1.98860003 1.5625,1.9887 1.5625,4.8296 z m 35.714295,36.3636004 0,13.6364 q 0,2.8409 -1.562505,4.8295 -1.5625,1.9887 -3.79465,1.9887 l -17.85714,0 q -2.23214,0 -3.79464,-1.9887 -1.5625,-1.9886 -1.5625,-4.8295 l 0,-13.6364 q 0,-2.8409 1.5625,-4.8295 1.5625,-1.9887 3.79464,-1.9887 l 17.85714,0 q 2.23215,0 3.79465,1.9887 1.562505,1.9886 1.562505,4.8295 z m 0,-36.3636004 0,13.6363004 q 0,2.841 -1.562505,4.8296 -1.5625,1.9886 -3.79465,1.9886 l -17.85714,0 q -2.23214,0 -3.79464,-1.9886 -1.5625,-1.9886 -1.5625,-4.8296 l 0,-13.6363004 q 0,-2.8409 1.5625,-4.8296 1.5625,-1.98860003 3.79464,-1.98860003 l 17.85714,0 q 2.23215,0 3.79465,1.98860003 1.562505,1.9887 1.562505,4.8296 z"/>' +
      '</svg>' +
      '<span class="lizard-apps-title">' + title + '</span>';

    var appsContainer = document.getElementById('lizard-apps-container');
    appsContainer.classList.add('hidden');
    appsContainer.innerHTML = '' +

    '<div class="lizard-apps">' +
      {% for app in view.screen.applications.all %}
        '<div class="lizard-apps-icon">' +
          '<a href="{{ app.url }}" target="_blank" title="{{ app.name }}">' +
            '<img src="//{{ request.get_host }}{{ MEDIA_URL }}{{ app.icon }}" />' +
            '<span class="lizard-app-title">{{ app.name }}</span>' +
          '</a>' +
        '</div>' +
      {% endfor %}
    '</div>';

    appsButton.onclick = function() {
      var e = document.getElementById('lizard-apps-container');
      e.classList.toggle('hidden');
    };
  }
})();
